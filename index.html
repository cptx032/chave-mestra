<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" type="image/png" href="imagens/favicon.png"/>
    <!--Estilos e animações-->
      <!--Materialize-->
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="stylesheet" type="text/css" href="css/materialize.css">
        <script type="text/javascript" src="js/materialize.min.js"></script>
      <!--Materialize-->
      <!--Google-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Google-->
      <!--jquery-->
        <script type="text/javascript" src="js/jquery.min.js"></script>
      <!--jquery-->
      <!--Scripts personalizados-->
        <script src="js/scripts.js"></script>
      <!--Scripts personalizados-->
      <meta charset="utf-8" />
    <!--Estilos e animações-->
  </head>
  <title>Chave Mestra</title>
  <body>
    <div class="card loadPage fundo"> <!-- Tela inicial (Personalização do usuário e cadastro das palavras) -->
      <div class="btn-floating detalhes white" onclick="javascript:$('#helpmodal').fadeIn()"><span>?</span></div>
      <div class="btn yellow darken-2 texto_1 btn-no-pointer">Bem-vindo ao jogo Chave-mestra <i class="material-icons large">videogame_asset</i></div>
      <div class="btn grey darken-2 texto_5">Adicione palavras ao jogo <i class="material-icons large">edit</i></div>
      <div class="cadPalavras modal"> <!-- Cadastra palavras das fases-->
        <div class="container">
          <div class="row rowCadPalavras">
            <div class="modal-footer">
              <a href="#!" class="fechaModal waves-effect waves-green btn red ">Fechar</a>
              <a href="#!" class="salvarPalavras waves-effect waves-green btn-flat yellow">Salvar<i class="material-icons right">save_alt</i></a>
              <a href="#!" class="maisPalavras waves-effect waves-green btn-flat ">Mais palavras...<i class="material-icons right">maps_ugc</i></a>
            </div>
            <div class="input-field col s12 l6">
              <i class="material-icons prefix">menu_book</i>
              <input id="first_level" class="palavraF palFase1" type="text" data-ls-module="charCounter" maxlength="12" >
              <label for="first_level">Palavra da 1a fase</label>
            </div>
            <div class="input-field col s12 l6">
              <i class="material-icons prefix">menu_book</i>
              <input id="second_level" class="palavraF palFase2" type="text" data-ls-module="charCounter" maxlength="12" >
              <label for="second_level">Palavra da 2a fase</label>
            </div>
          </div>
        </div>
      </div>
      <div class="btn yellow darken-2 choose_name pulse">Click e escolha seu nome e avatar</div>
      <div id="helpmodal" class="modal">
        <div class="container">
          <div class="row">
            <form class="col s12">
              <div class="row">
                <h3>Bem vindo ao Jogo Chave-Mestra</h3>
                <h6>
                  <p>
                    O objetivo do jogo é ajudar seu personagem a coletar todas
                    as letras para formar as palavras.
                  </p>
                  <p>
                    A palavra que você precisa formar está presente no lado
                    direito da tela.
                  </p>
                  <p>
                    Quanto mais letras coletadas mais estrelas!
                  </p>
                  <p>
                    Cuidado ao escolher letras erradas, você perde uma estrela
                    a cada letra errada coletada.
                  </p>
                </h6>
              </div>
              <div class="modal-footer">
                <a href="javascript:$('#helpmodal').fadeOut()" class="waves-effect waves-green btn-flat">Fechar</a>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="personalize modal"> <!-- Nome e foto (avatar) do jogador -->
        <div class="container">
          <div class="row">
            <form class="col s12">
              <div class="row">
                <div class="col s12 l1">
                  <div class="btn-floating btn-large waves-effect waves-light white j1"><img src="perfis/1.png" alt="" class="circle"></div>
                </div>
                <div class="input-field col s12 l10 offset-l1">
                  <input id="icon_prefix" type="text" class="nomeJogador">
                  <label for="icon_prefix">Nome do jogador</label>
                </div>
                <div class="file-field input-field col s12">
                  <div class="btn">
                    <span>File</span>
                    <input type="file" multiple>
                  </div>
                  <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Selecione sua foto">
                  </div>
                </div>
                <ul class="collection">
                  <div class="col l2 s4 hoverable divAvatar">
                    <li class="collection-item avatar">
                      <img src="perfis/1.png" alt="" class="circle">
                    </li>
                  </div>
                  <div class="col l2 s4 hoverable divAvatar">
                    <li class="collection-item avatar">
                      <img src="perfis/2.png" alt="" class="circle">
                    </li>
                  </div>
                  <div class="col l2 s4 hoverable divAvatar">
                    <li class="collection-item avatar">
                      <img src="perfis/3.png" alt="" class="circle">
                    </li>
                  </div>
                  <div class="col l2 s4 hoverable divAvatar">
                    <li class="collection-item avatar">
                      <img src="perfis/4.png" alt="" class="circle">
                    </li>
                  </div>
                  <div class="col l2 s4 hoverable divAvatar">
                    <li class="collection-item avatar">
                      <img src="perfis/5.png" alt="" class="circle">
                    </li>
                  </div>
                  <div class="col l2 s4 hoverable divAvatar">
                    <li class="collection-item avatar">
                      <img src="perfis/6.png" alt="" class="circle">
                    </li>
                  </div>
                </ul>
              </div>
              <div class="modal-footer">
                <a href="#!" class="fechaPersonalize waves-effect waves-green btn-flat">Fechar</a>
                <a href="#!" class="salvaDados waves-effect waves-green btn-flat yellow">Salvar</a>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="btn yellow darken-2 texto_3 btn-no-pointer">
        Classificação: <div><span>E</span></div> <div>(Para todos os públicos)</div>
      </div>
      <div class="card txtStartJogo">Carregar informações e visualizar jogo.</div>
      <div id="new_game" class="texto_4"><div class="btn black darken-2 playIcon">Novo jogo</div><i class="material-icons medium playCircle">play_circle</i></div>
      <div class="card creditos">
        <div id="creditos1">
          <div style="text-align: center; font-weight: 500"> Créditos
          </div>
          <div id="creditos2">
            <div>UFRN - iMD 2020</div>
            <div>
              <strong>Desenvolvedores:</strong> Diogo Eugênio, Willie da Paz e Lucas Ribeiro
            </div>
            <div>
              <strong>Ícones baixados de:</strong> <a class="blue-link" href="https://icons8.com.br/">Icons8</a> e <a class="blue-link" href="https://www.iconfinder.com/">Icon Finder</a>
            </div>
            <div>
              <strong>Background Image:</strong> <a class="blue-link" href="https://www.freepik.com/vectors/background">FreePik</a>
            </div>
          </div>
      </div>
    </div>
    <div class="container runGame">   <!-- Tela do Jogo -->
      <div class="row card"> <!--Estrelas--> <!--Clones--> <!--Número da Fase--> <!--Tela do jogo-->
        <div id="jogoD" class="col s10">
          <div id="divPainelUser" class="col s12 btn cyan lighten-5"> <!--Painel de cima-->
            <div class="col s7 l6 xl5 starPanel"> <!--Estrelas-->
              <i class="material-icons star starB star1">star_border</i>
              <i class="material-icons star starB star2">star_border</i>
              <i class="material-icons star starB star3">star_border</i>
              <i class="material-icons star starB star4">star_border</i>
              <i class="material-icons star starB star5">star_border</i>
            </div>
            <div class="col s4 l4 xl4 lifePanel"> <!--Corações-->
              <i class="material-icons life1 btn-floating white">favorite</i>
              <i class="material-icons life2 btn-floating white">favorite</i>
              <i class="material-icons life3 btn-floating white">favorite</i>
            </div>
            <div class="col s1 l2 xl3 divnFase"> <!--Fase-->
              <a id="nFase" class="btn-floating btn-medium white darken-2 waves-effect waves-light right"></a>
            </div>
          </div>
          <div id="divAnimacao" class="col s12"> <!--Jogador e letras caindo-->
            <div class="vidro"><!-- Botões de início e próxima fase -->
              <div class="startGame"><!-- Botão de início de jogo -->
                <div class="col s12">
                  <div class="col s8 offset-s1 l5 offset-l1 card hoverable controlTeclado">
                    <div class="col s12"><i class="material-icons">keyboard</i></div>
                    <div class="col s12">Teclado</div>
                  </div>
                  <div class="col s8 offset-s1 l5 offset-l1 card hoverable controlMouse">
                    <div class="col s12"><i class="material-icons">mouse</i></div>
                    <div class="col s12">Mouse</div>
                  </div>
                  <div class="col s8 offset-s1 l5 offset-l1 card hoverable controlCam">
                    <div class="col s12"><i class="material-icons">photo_camera_front</i></div>
                    <div class="col s12">Câmera</div>
                  </div>
                </div>
              </div>
              <div class="proxFase"><!-- Botão Próxima fase -->
                <div class="btn blue lighten-2 fim1">Parabéns! Aguarde, estamos carregando a nova fase para você.</div>
                <div class="btn black fim2">Nova fase desbloqueada<i class="material-icons right chaveIco2">lock_open</i></div>
              </div>
              <div class="btn blue lighten-2 vidro-green-left">
                <div class="col s12">A</div>
                <div class="col s12">G</div>
                <div class="col s12">U</div>
                <div class="col s12">A</div>
                <div class="col s12">R</div>
                <div class="col s12">D</div>
                <div class="col s12">E</div>
              </div>
              <div class="load"><img src="imagens/imd.jpg" alt=""></div> <!--Load próxima fase-->
              <div class="gameOver"><!-- Tela Game Over -->
                <div class="fim3">
                  <span class="g">G</span>
                  <span class="a">A</span>
                  <span class="m">M</span>
                  <span class="e">E</span>
                  <span class="oo">&nbsp;</span>
                  <span class="o">O</span>
                  <span class="v">V</span>
                  <span class="e">E</span>
                  <span class="r">R</span>
                  <span class="material-icons large right">videogame_asset_off</span>
                </div>
                <div class="fim4">Continuar? <div class="btn-floating large green lighten-2 pulse hoverable"><i class="material-icons large right">play_circle</i></div></div>
                <div class="fim5">Voltar para o início? <div class="btn-floating large grey pulse hoverable"><i class="material-icons large right">play_circle</i></div></div>
              </div>
              <div class="fimJogo"><!-- Botão Próxima fase -->
                <div class="row">
                </div>
              </div>
            </div>
              <div id="j1" class="waves-effect waves-light j1">
                <img id="circle1" src="perfis/1.png" alt="" class="circle"> <!--Ícone do Jogador-->
              </div>
          </div>
        </div>
        <div class="col s2" style="position: relative;"> <!--Acomoda a palavra chave-->
          <div id="palavraChave" class="col s12">
          </div>
        </div>
      </div>
    </div>
    <div class="container"><!-- Detalhes da fase: Nome do jogador, pontos e estrelas coletadas-->
      <div class="row">
        <div id="final" class="col s12 card">
          <div class="col s4"><span class="telaInfo">Nome Jogador</span></div>
          <div class="col s2"><span class="telaInfo">Pontos</span></div>
          <div class="col s3"><span class="telaInfo">Total estrelas</span><div class="material-icons left medium">star</div></div>
          <div class="col s3"><span class="telaInfo">Velocidade</span><div class="material-icons left medium">flash_on</div></div>
          <div class="col s4"><span class="detInfo" id="nomeJogador"></span></div>
          <div class="col s2"><span class="detInfo" id="pontos"></span></div>
          <div class="col s3"><span class="detInfo" id="totalEstrelas"></span></div>
          <div class="col s3"><span class="detInfo" id="velocidade"></span></div>
        </div>
      </div>
    </div>
    <script>
      //Variáveis do jogo
        var palavraChave = ["A","BOLA","UVA","CABANA","BATATA","COCADA","BILOCA","PANELA","ABACATE","JERIMUM","NATALINO"] //Palavras que serão usadas em cada fase, ordem crescente. Máximo 12 caracteres
        var alfabetoBig  = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","X","Y","Z","W"] //Letras do alfabeto que cairão para serem coletadas
        var alfabetoMin  = ["a","b","c","d","e","f","g","h","i","j","l","l","m","n","o","p","q","r","s","t","u","v","x","y","z","w"] //Letras do alfabeto que cairão para serem coletadas
        var nFase = 0
        var maxLetras = 14                    //Limite de letras das palavras chave + 1
        var nLetrasFase1 = [4,5,3,6]          //Quantidade de letras que caem na 1 e 2a fase
        var nLetrasFase2 = [6,8,5,6]          //Quantidade de letras que caem na 3 e 4a fase
        var nLetrasFase3 = [7,8,9,8]          //Quantidade de letras que caem na 5 e 6a fase
        var nLetrasFase4 = [7,8,9,8,10,11]    //Quantidade de letras que caem na 7 e 8a fase
        var nLetrasFase5 = [7,8,9,8,10,11,12] //Quantidade de letras que caem na 9 e 10a fase

        var nomeJogador  = 'Jogador'
        var letrasDaChave   = []     //Lista com a palavra escolhida
        var letrasColetadas = []     //Lista que vai sendo preenchida com as letras capturadas pelo jogador
        var letra = v1 =  v2 = tecla = joystick = item = ''
        var xPalavra = 3
        var tempoCascata  = 10500    //Velocidade que as letras serão geradas, em milissegundos
        var removeLetras  = 10000;   //Tempo para remover as letras
        var totalEstrelas = totalPontos = telaW = telaH = mX = mY = xUltPosicao = yUltPosicao = xj1 = yj1 = posicaoW = nLtr = nLtr = penalidade = mTop = mLeft = idLetraVal =0
        var item0 = item1 = item2 = stopLetras = stopProcessLetras = 0
        var velox    = 30            //Velocidade do movimento do jogador, medida em pixel
        var horizontal = velox
        var vertical   = 55
        var estrelas = 0
        var life     = 3
        var fim = false // Se esta variável estiver true significa que o jogador completou a fase

      //Efeitos da tela inicial
        $('.texto_1').fadeToggle(1000);
        $('.choose_name').fadeToggle(2000);
        $('.choose_name').click(function()
        {
          $('.personalize').fadeIn()
        })
        $('.texto_3').fadeToggle(3000);
        $('.texto_4').fadeToggle();
        $('#new_game').click(function()
        {
          $('.vidro-green-left, .creditos, .detalhes').hide()
          setTimeout(function()
          {
            $('.runGame').fadeIn(500);
            $('.texto_3').hide();
          }, 20);
          setTimeout(function()
          {
            $('#final').fadeIn();
          }, 500);
          setTimeout(function()
          {
            $('.startGame').fadeIn();
          }, 1000);
        });
        $('.texto_4').mouseenter(function()
        {
          $('.txtStartJogo').fadeIn()
        })
        $('.texto_4').mouseleave(function()
        {
          $('.txtStartJogo').fadeOut()
        })
        $('.texto_5').fadeToggle(3000);
        $('.texto_5').click(function()
        {
          $('.cadPalavras').show()
        })
        $('#creditos1').click(function()
        {
          $('#creditos2').fadeToggle(500)
        })
        $('.fechaPersonalize').click(function()
        {
          $('.personalize').fadeOut()
        })
        $('.fechaModal').click(function()
        {
          $('.cadPalavras').hide()
        })
        $('.fim4').click(function()
        {
          $('i').remove('.life1');$('i').remove('.life2');$('i').remove('.life3')
          for(i=1; i<=3; i++){$(".lifePanel").fadeIn(500).append('<i class="material-icons life'+i+' btn-floating white">favorite</i>')}
          life = 3
          nFase = nFase
        })
        $('.fim5').click(function()
        {
          $('i').remove('.life1');$('i').remove('.life2');$('i').remove('.life3')
          for(i=1; i<=3; i++){$(".lifePanel").fadeIn(500).append('<i class="material-icons life'+i+' btn-floating white">favorite</i>')}
          life = 3
          nFase = 1
          totalEstrelas = 0
          totalPontos = 0
        })
        //Atribuindo dados e foto do jogador
        $('#nomeJogador').html(nomeJogador)
        $('.salvaDados').click(function()     //Adiciona nome
        {
          $('.personalize').fadeOut()
          if($('.nomeJogador').val().length > 0)
          {
            nomeJogador = $('.nomeJogador').val()
            $('#nomeJogador').html(nomeJogador)
          }
          else
          {
            $('#nomeJogador').html(nomeJogador)
          }
        })
        $('.circle').click(function ()        //Seleciona avatar
        {
          var avatar = $(this).attr('src')
          $(".j1").empty()
          $(".j1").append('<img id="circle1" src="'+avatar+'" alt="" class="circle">')

        })
        $('.maisPalavras').click(function()   //Mostra mais inputs para cadastrar palavras
        {
          if(xPalavra < 11)
          {
            $('.rowCadPalavras').append('<div class="input-field col s12 l6"><i class="material-icons prefix">menu_book</i><input id="icon_prefix" class="palavraF palFase'+xPalavra+'" type="text" data-ls-module="charCounter" maxlength="12" ><label for="icon_prefix">Palavra da '+xPalavra+'a fase</label></div>')
            xPalavra ++
          }
          else
          {
            alert('Ops! O limite de palavras é 10, você já cadastrou o máximo de palavras.\n\n Se já finalizou clique em salvar.')
          }
        })
        $('.salvarPalavras').click(function() //Aciona botão salvar palavras
        {
          for(i = 1; i < xPalavra; i++)
          {
            var pp = $('.palFase'+i).val()
            if(pp.length != 0) {palavraChave[i] = pp}
          }
          $('.cadPalavras').fadeOut(1000)
        })
      //Seleciona modo de controle do jogo
        $('.controlTeclado').click(function()
        {
         movJogadorK()
        })
        $('.controlMouse').click(function()
        {
          movJogadorM()
        })
        $('.controlCam').click(function()
        {
          movJogadorC()
        })
      //Início do jogo
      $('.controlTeclado, .controlMouse, .controlCam, .fim2, .fim4, .fim5').click(function()
      {
        fim = false
        $('.vidro-green-top').hide()
        telaW = parseInt($('#divAnimacao').width())
        telaH = parseInt($('#divAnimacao').height())
        estrelas = 0
        velox    = 30            //Velocidade do movimento do jogador, medida em pixel
        for(i=0; i<5; i++){$(".starPanel > i:nth-child("+i+")").fadeIn().html('star_border')}
        $('#velocidade').html(0)
        $('.vidro').hide()
        $('.pC').removeClass('blue')
        $('.pC').addClass('white')
        $('.pC').hide()
        $('#nFase').html(nFase)
        $('#totalEstrelas').html(totalEstrelas)
        $('#pontos').html(totalPontos)
        sortPalChave()
      //Gera quantidade de letras que cairão a cada (var tempoCastaca)segundos
        var nLS = Math.floor(Math.random() * (3 - 0) + 1);
        var nL = nLetrasFase1[nLS]
        geraLetras(nL)
        stopLetras = setInterval(function()
        {
          var nLS = Math.floor(Math.random() * (4 - 0) + 1);
          if(nFase == 1 || nFase == 2)
          {nL = nLetrasFase1[nLS]}
          if(nFase == 3 || nFase == 4)
          {nL = nLetrasFase2[nLS]}
          if(nFase >= 5 || nFase == 6)
          {nL = nLetrasFase3[nLS]}
          if(nFase == 7 || nFase == 8)
          {nL = nLetrasFase4[nLS]}
          if(nFase >= 9 || nFase == 10)
          {nL = nLetrasFase5[nLS]}

          geraLetras(nL)
        }, tempoCascata);

      //Prepara a letrasColetadas para receber as letras capturadas pelo jogador a fim de comparar as listas e saber quando o usuário ganhou
        for(i = 0; i < letrasDaChave.length; i ++)
        {
          letrasColetadas[i] = '-'
        }
        stopProcessLetras = window.setInterval(function()
        {
          var div = document.getElementById('j1');
          var rect = div.getBoundingClientRect();
          xj1 = rect.x;
          yj1 = rect.y;

          for(ii = 0; ii <= (nL+2); ii++)
          {
            var cH = 'cH'+ii
            if(cH == 'cH0')
            {
              var div = document.getElementById('cH0');
            }
            if(cH == 'cH1')
            {
              var div = document.getElementById('cH1');
            }
            if(cH == 'cH2')
            {
              var div = document.getElementById('cH2');
            }
            if(cH == 'cH3')
            {
              var div = document.getElementById('cH3');
            }
            if(cH == 'cH4')
            {
              var div = document.getElementById('cH4');
            }
            if(cH == 'cH5')
            {
              var div = document.getElementById('cH5');
            }
            if(cH == 'cH6')
            {
              var div = document.getElementById('cH6');
            }
            if(cH == 'cH7')
            {
              var div = document.getElementById('cH7');
            }
            if(cH == 'cH8')
            {
              var div = document.getElementById('cH8');
            }
            if(cH == 'cH9')
            {
              var div = document.getElementById('cH9');
            }
            if(cH == 'cH10')
            {
              var div = document.getElementById('cH10');
            }
            if(cH == 'cH11')
            {
              var div = document.getElementById('cH11');
            }

            if (document.getElementById(cH))
            {
              var rect = div.getBoundingClientRect();
              var xcH = rect.x;
              var ycH = rect.y;

              processaLetras(cH, xj1, yj1, xcH, ycH) //Verifica se a letra coletada compõe a palavra e toma decisão de acordo com a resposta
            }
          }
        })
      })
    </script>
  </body>
</html>
